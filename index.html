<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Always-On AR Video</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
  <div id="loading">
    Loading AR experience...
  </div>

  <!-- AR Scene with normal camera settings -->
  <a-scene 
    embedded 
    arjs="
      trackingMethod: best;
      sourceType: webcam;
      debugUIEnabled: false;
      sourceWidth: 1280;
      sourceHeight: 720;
    "
    renderer="logarithmicDepthBuffer: true;">

    <!-- Video Element (always visible) -->
    <a-video
      id="ar-video"
      src="assets/sample-video.mp4"
      width="1.6"
      height="0.9"
      position="0 0 0"
      rotation="-90 0 0"
      autoplay
      loop
      visible="true"
    ></a-video>

    <!-- Marker (optional - just for positioning) -->
    <a-marker preset="hiro" id="video-marker" visible="false">
      <!-- Empty - we just use it for coordinates -->
    </a-marker>

    <!-- Camera with normal FOV -->
    <a-entity camera="fov: 80;"></a-entity>
  </a-scene>

  <script>
    window.addEventListener('load', () => {
      const scene = document.querySelector('a-scene');
      const video = document.getElementById('ar-video');
      const loadingScreen = document.getElementById('loading');

      // Wait for scene to initialize
      scene.addEventListener('loaded', () => {
        loadingScreen.style.display = 'none';
        
        // Force video to play (mobile browsers require this)
        const videoElement = video.components.material.material.map.image;
        videoElement.play().catch(e => console.log("Auto-play prevented:", e));
        
        // Optional: Use marker position if found
        const marker = document.getElementById('video-marker');
        marker.addEventListener('markerFound', (e) => {
          // Snap video to marker position when detected
          video.setAttribute('position', e.detail.target.object3D.position);
        });
      });

      // Fallback: If video doesn't autoplay, add play button
      video.addEventListener('click', () => {
        video.components.material.material.map.image.play();
      });
    });
  </script>
</body>
</html>